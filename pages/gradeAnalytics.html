<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
</head>
<body>
    <h1>Grade Analytics</h1>
    <a href="/">home</a><br>

    <div id="chart" style="display: inline-block; vertical-align: top;"></div>
    <div id="minMaxChart" style="display: inline-block; vertical-align: top;"></div>
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script>
        const categories = [
            "Maths", "English", "Science", "History", "Geography", "Art", "Music", "PE", "IT", "RE"
        ];

        const names = ["Alice", "Bob", "Charlie", "David", "Eve", "Frank", "Grace", "Hannah", "Ivy", "Jack"];
        const data = Array.from({ length: 10 }, (_, i) => ({
            score: Math.random() * 100,
            module: categories[Math.floor(Math.random() * categories.length)],
            name: names[Math.floor(Math.random() * names.length)]
        }));

        const margin = {top: 28, right: 30, bottom: 100, left: 100};
        const width = (window.innerWidth * 0.7) - margin.left - margin.right;
        const height = (window.innerHeight * 0.8) - margin.top - margin.bottom;

        // creating chart SVG in div
        const svg = d3.select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // all the subjects in the data
        const x = d3.scaleBand()
            .domain(categories)
            .range([0, width])
            .padding(0.1);

        // frequency from 0 to max frequency on y axis
        const y = d3.scaleLinear()
            .domain([0, 100])
            .range([height, 0]);

        // moving the x and y axis to the bottom and left
        svg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${height})`)
            .call(d3.axisBottom(x).tickSizeOuter(0))
            .append("text")
            .attr("class", "axis-label")
            .attr("x", width / 2)
            .attr("y", 65)
            .attr("fill", "black")
            .style("text-anchor", "middle")
            .style("font-size", "2rem")
            .text("Modules");

        svg.append("g")
            .attr("class", "y-axis")
            .call(d3.axisLeft(y).tickSizeOuter(0))
            .append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height / 2)
            .attr("y", -65)
            .attr("fill", "black")
            .style("text-anchor", "middle")
            .style("font-size", "2rem")
            .text("Score %");

        svg.append("text")
            .attr("x", width / 2)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .style("font-size", "1.5rem")
            .text("Student Scores by Module");

        // Tooltip div
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("position", "absolute")
            .style("background", "#f9f9f9")
            .style("padding", "5px")
            .style("border", "1px solid #d3d3d3")
            .style("border-radius", "5px")
            .style("pointer-events", "none")
            .style("opacity", 0);

        svg.selectAll(".dot")
            .data(data)
            .enter()
            .append("circle")
            .attr("class", "dot")
            .attr("cx", d => x(d.module) + x.bandwidth() / 2)
            .attr("cy", d => y(d.score))
            .attr("r", d => Math.max(d.score / 10, 5)) // Dot size relative to the score, minimum size 5px
            .attr("fill", "steelblue")
            .on("mouseover", (event, d) => {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(`Module: ${d.module}<br> Name: ${d.name}<br> Score: ${d.score.toFixed(2)}%`)
            .style("left", (event.pageX + 5) + "px")
            .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", () => {
            tooltip.transition().duration(500).style("opacity", 0);
            });

        // Increase the font size of the tick labels
        svg.selectAll(".x-axis .tick text")
            .style("font-size", "1rem");

        svg.selectAll(".y-axis .tick text")
            .style("font-size", "1rem");

        // creating min max chart
        const margin2 = {top: 20 + parseFloat(getComputedStyle(document.documentElement).fontSize) * 1.5, right: 30, bottom: 100, left: 100};
        const width2 = (window.innerWidth * 0.25) - margin2.left - margin2.right;
        const height2 = (window.innerHeight * 0.85) - margin2.top - margin2.bottom;

        const minMaxSvg = d3.select("#minMaxChart")
            .append("svg")
            .attr("width", width2 + margin2.left + margin2.right)
            .attr("height", height2 + margin2.top + margin2.bottom)
            .append("g")
            .attr("transform", `translate(${margin2.left},${margin2.top})`);

        minMaxSvg.append("text")
            .attr("x", width2 / 2)
            .attr("y", -10)
            .attr("text-anchor", "middle")
            .style("font-size", "1.5rem")
            .text("Min Max Module Scores");

        const minMaxData = categories.map(category => {
            const scores = data.filter(d => d.module === category).map(d => d.score);
            return {
                module: category,
                min: d3.min(scores),
                max: d3.max(scores)
            };
        });

        const minMaxX = d3.scaleLinear()
            .domain([0, 100])
            .range([0, width2]);

        const minMaxY = d3.scaleBand()
            .domain(categories)
            .range([0, height2])
            .padding(0.1);

        minMaxSvg.append("g")
            .attr("class", "x-axis")
            .attr("transform", `translate(0,${height2})`)
            .call(d3.axisBottom(minMaxX).tickSizeOuter(0))
            .append("text")
            .attr("class", "axis-label")
            .attr("x", width2 / 2)
            .attr("y", 65)
            .attr("fill", "black")
            .style("text-anchor", "middle")
            .style("font-size", "1.25rem")
            .text("Score %");

        minMaxSvg.append("g")
            .attr("class", "y-axis")
            .call(d3.axisLeft(minMaxY).tickSizeOuter(0))
            .append("text")
            .attr("class", "axis-label")
            .attr("transform", "rotate(-90)")
            .attr("x", -height2 / 2)
            .attr("y", -75)
            .attr("fill", "black")
            .style("text-anchor", "middle")
            .style("font-size", "1.25rem")
            .text("Modules");

        minMaxSvg.selectAll(".min-bar")
            .data(minMaxData)
            .enter()
            .append("rect")
            .attr("class", "min-bar")
            .attr("x", 0)
            .attr("y", d => minMaxY(d.module))
            .attr("width", d => minMaxX(d.min))
            .attr("height", minMaxY.bandwidth() / 2)
            .attr("fill", "red");

        minMaxSvg.selectAll(".max-bar")
            .data(minMaxData)
            .enter()
            .append("rect")
            .attr("class", "max-bar")
            .attr("x", 0)
            .attr("y", d => minMaxY(d.module) + minMaxY.bandwidth() / 2)
            .attr("width", d => minMaxX(d.max))
            .attr("height", minMaxY.bandwidth() / 2)
            .attr("fill", "green");

        // Tooltip div for minMaxChart
        const minTooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("position", "absolute")
            .style("background", "#f9f9f9")
            .style("padding", "5px")
            .style("border", "1px solid #FF0000")
            .style("border-radius", "5px")
            .style("pointer-events", "none")
            .style("opacity", 0);

        const maxTooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("position", "absolute")
            .style("background", "#f9f9f9")
            .style("padding", "5px")
            .style("border", "1px solid #00FF00")
            .style("border-radius", "5px")
            .style("pointer-events", "none")
            .style("opacity", 0);

        minMaxSvg.selectAll(".min-bar")
            .on("mouseover", (event, d) => {
            const scores = data.filter(item => item.module === d.module && item.score === d.min);
            const names = scores.map(item => item.name).join(", ");
            minTooltip.transition().duration(200).style("opacity", .9);
            minTooltip.html(`Module: ${d.module}<br> Name: ${names}<br> Min Score: ${d.min.toFixed(2)}%`)
                .style("left", (event.pageX + 5) + "px")
                .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", () => {
                minTooltip.transition().duration(500).style("opacity", 0);
            });

        minMaxSvg.selectAll(".max-bar")
            .on("mouseover", (event, d) => {
            const scores = data.filter(item => item.module === d.module && item.score === d.max);
            const names = scores.map(item => item.name).join(", ");
            maxTooltip.transition().duration(200).style("opacity", .9);
            maxTooltip.html(`Module: ${d.module}<br> Name: ${names}<br> Max Score: ${d.max.toFixed(2)}%`)
                .style("left", (event.pageX + 5) + "px")
                .style("top", (event.pageY - 28) + "px");
            })
            .on("mouseout", () => {
                maxTooltip.transition().duration(500).style("opacity", 0);
            });
    </script>
</body>
</html>